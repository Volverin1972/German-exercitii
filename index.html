<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Germana Expert ULTIMATE</title>
    <style>
        :root {
            --bg-app: #f0f2f5;
            --bg-card: #ffffff;
            --main-green: #28a745;
            --accent-blue: #007bff;
            --text-main: #333;
            --f-size-read: 24px;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-app); color: var(--text-main); margin: 0; padding-top: 60px; transition: background 0.3s; }

        /* Top Bar & Translation Popover */
        #top-bar { position: fixed; top: 0; width: 100%; height: 60px; background: white; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 1000; box-sizing: border-box; }
        #translation-display { font-weight: bold; color: var(--accent-blue); font-size: 18px; flex-grow: 1; text-align: center; }

        /* Pagini */
        .page { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Grid Nivele */
        .grid-levels { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .lvl-btn { border: none; padding: 30px; border-radius: 15px; font-size: 22px; font-weight: bold; cursor: pointer; color: white; background: var(--main-green); }

        /* Lectura & Interactivitate */
        .word { cursor: pointer; display: inline-block; padding: 0 2px; border-radius: 4px; }
        .word:active { background: #d1e7ff; }
        .story-container { background: var(--bg-card); padding: 20px; border-radius: 15px; font-size: var(--f-size-read); line-height: 1.6; }

        /* Setari & Backup (Ca in poza ta) */
        .settings-container { background: white; padding: 20px; border-radius: 20px; max-width: 500px; margin: auto; }
        .s-item { margin-bottom: 20px; }
        input[type="range"], select, input[type="text"], textarea { width: 100%; margin-top: 8px; padding: 10px; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        .btn-save { background: var(--main-green); color: white; width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .btn-backup { background: var(--accent-blue); color: white; width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="top-bar">
        <button onclick="goHome()" style="background:none; border:none; font-size:20px;">üè†</button>
        <div id="translation-display">Atinge un cuv√¢nt...</div>
        <button onclick="showPage('settings-page')" style="background:none; border:none; font-size:20px;">‚öôÔ∏è</button>
    </div>

    <div id="home-page" class="page active">
        <div class="grid-levels" id="levels-grid">
            <button class="lvl-btn" onclick="openLevel('A1')">A1</button>
            <button class="lvl-btn" onclick="openLevel('A2')">A2</button>
        </div>
    </div>

    <div id="read-page" class="page">
        <h2 id="read-title">LecturƒÉ</h2>
        <div class="story-container" id="story-content"></div>
    </div>

    <div id="settings-page" class="page">
        <div class="settings-container">
            <h3>‚öôÔ∏è SetƒÉri & Backup</h3>
            
            <div class="s-item">
                <label>Culoare Fundal Butoane:</label>
                <input type="color" id="color-picker" onchange="updateColors(this.value)" style="height: 40px;">
            </div>

            <div class="s-item">
                <label>Font LecturƒÉ: <span id="font-val">24px</span></label>
                <input type="range" min="16" max="40" value="24" oninput="updateFont(this.value)">
            </div>

            <div class="s-item">
                <label>VitezƒÉ Voce:</label>
                <input type="range" min="0.5" max="1.5" step="0.1" value="1" id="voice-speed">
            </div>

            <hr>
            <h3>‚ûï AdaugƒÉ Material</h3>
            <select id="add-lvl"><option>A1</option><option>A2</option></select>
            <select id="add-type"><option value="read">LecturƒÉ</option><option value="test">Test</option></select>
            <input type="text" id="add-title" placeholder="Titlu...">
            <textarea id="add-content" rows="4" placeholder="Con»õinut (pentru traducere foloseste formatul: cuv√¢nt|traducere)"></textarea>
            
            <button class="btn-save" onclick="saveContent()">üíæ SALVEAZƒÇ</button>
            <button class="btn-backup" onclick="exportData()">üì© SALVEAZƒÇ BACKUP</button>
            
            <div class="s-item" style="margin-top:15px;">
                <label>Restaurare Date (.json):</label>
                <input type="file" id="import-file" onchange="importData(event)">
            </div>

            <button onclick="goHome()" style="width:100%; padding:15px; margin-top:20px; border-radius:10px; background:#333; color:white; border:none;">√éNCHIDE</button>
        </div>
    </div>

    <script>
        // Baza de date localƒÉ
        let appData = JSON.parse(localStorage.getItem('germanaData')) || {
            levels: { 'A1': [], 'A2': [] },
            settings: { color: '#28a745', fontSize: 24 }
        };

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function goHome() { showPage('home-page'); }

        // Func»õia de procesare text pentru dic»õionar
        function processText(text) {
            return text.split(' ').map(rawWord => {
                const [word, trans] = rawWord.split('|');
                return `<span class="word" onclick="handleWord('${word}', '${trans || '...'}')">${word}</span>`;
            }).join(' ');
        }

        function handleWord(word, trans) {
            document.getElementById('translation-display').innerText = `${word} = ${trans}`;
            speak(word);
        }

        function speak(text) {
            const msg = new SpeechSynthesisUtterance();
            msg.text = text;
            msg.lang = 'de-DE';
            msg.rate = document.getElementById('voice-speed').value;
            window.speechSynthesis.speak(msg);
        }

        function saveContent() {
            const lvl = document.getElementById('add-lvl').value;
            const type = document.getElementById('add-type').value;
            const title = document.getElementById('add-title').value;
            const content = document.getElementById('add-content').value;

            appData.levels[lvl].push({ type, title, content });
            localStorage.setItem('germanaData', JSON.stringify(appData));
            alert("Salvat cu succes!");
        }

        function openLevel(lvl) {
            const content = appData.levels[lvl][0]; // Deschide prima lecturƒÉ adƒÉugatƒÉ pentru demo
            if(!content) return alert("Niciun material adƒÉugat pentru " + lvl);
            
            document.getElementById('read-title').innerText = content.title;
            document.getElementById('story-content').innerHTML = processText(content.content);
            showPage('read-page');
        }

        // --- SetƒÉri & Backup ---
        function updateColors(color) {
            appData.settings.color = color;
            document.querySelectorAll('.lvl-btn').forEach(b => b.style.background = color);
            localStorage.setItem('germanaData', JSON.stringify(appData));
        }

        function updateFont(size) {
            document.getElementById('font-val').innerText = size + "px";
            document.getElementById('story-content').style.fontSize = size + "px";
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appData));
            const dlAnchorElem = document.createElement('a');
            dlAnchorElem.setAttribute("href", dataStr);
            dlAnchorElem.setAttribute("download", "backup_germana.json");
            dlAnchorElem.click();
        }

        function importData(event) {
            const reader = new FileReader();
            reader.onload = (e) => {
                appData = JSON.parse(e.target.result);
                localStorage.setItem('germanaData', JSON.stringify(appData));
                location.reload();
            };
            reader.readAsText(event.target.files[0]);
        }

        // Aplicare setƒÉri la pornire
        if(appData.settings.color) updateColors(appData.settings.color);
    </script>
</body>
</html>
