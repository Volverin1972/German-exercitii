<div id="home-page" class="page active">
    <h3>Alege nivelul:</h3>
    <div class="grid-levels" id="levels-grid">
        </div>
</div>

<script>
    // 1. Inițializare bază de date cu suport pentru B1
    let appData = JSON.parse(localStorage.getItem('germanaData')) || {
        levels: { 'A1': [], 'A2': [], 'B1': [] },
        settings: { color: '#28a745', fontSize: 24 }
    };

    // 2. Funcție care desenează butoanele pe ecran
    function renderLevelButtons() {
        const grid = document.getElementById('levels-grid');
        grid.innerHTML = ''; // Curățăm ce era înainte

        Object.keys(appData.levels).forEach(lvl => {
            const btn = document.createElement('button');
            btn.className = 'lvl-btn';
            btn.innerText = lvl;
            btn.style.background = appData.settings.color;
            btn.onclick = () => openLevel(lvl);
            grid.appendChild(btn);
        });
    }

    // 3. Modificarea funcției de salvare pentru a accepta nivele noi
    function saveContent() {
        const lvl = document.getElementById('add-lvl').value;
        const type = document.getElementById('add-type').value;
        const title = document.getElementById('add-title').value;
        const content = document.getElementById('add-content').value;

        if (!title || !content) {
            alert("Te rugăm să completezi Titlul și Conținutul!");
            return;
        }

        // Dacă nivelul nu există în baza de date (ex: B1), îl creăm
        if (!appData.levels[lvl]) {
            appData.levels[lvl] = [];
        }

        appData.levels[lvl].push({ type, title, content });
        localStorage.setItem('germanaData', JSON.stringify(appData));
        
        alert(`Salvat cu succes în ${lvl}!`);
        renderLevelButtons(); // Actualizăm butoanele imediat
    }

    // 4. Funcția de deschidere corectată
    function openLevel(lvl) {
        const items = appData.levels[lvl];
        
        if (!items || items.length === 0) {
            alert("Acest nivel nu are încă lecții sau teste salvate. Mergi la Setări și adaugă material.");
            return;
        }

        // Momentan deschidem ultima lecție adăugată
        const lastItem = items[items.length - 1];
        
        document.getElementById('read-title').innerText = `${lvl}: ${lastItem.title}`;
        document.getElementById('story-content').innerHTML = processText(lastItem.content);
        showPage('read-page');
    }

    // 5. Rulăm la pornire pentru a afișa butoanele salvate
    renderLevelButtons();

    // Păstrează restul funcțiilor (processText, handleWord, speak, etc.) din codul anterior
</script>
